# 要件定義ガイド - RDRAワークフロー解説

## 概要

本ガイドでは、リレーションシップ駆動要件分析(RDRA)を使った要件定義のワークフローを解説します。RDRAは決められたアイコンを使い、アイコンとアイコン、アイコンと図を関連づけ、アイコンで表現されたモデル要素と関連のつながりから要件を説明する軽量な要件分析フレームワークです。

## RDRA用語解説

### 基本概念

- **RDRA（リレーションシップ駆動要件分析）**: Relationship Driven Requirements Analysisの略。決められたアイコンとモデル要素の関連から要件を説明する手法
- **モデル要素**: RDRAで定義された各種のアイコン（アクター、ユースケース、情報など）
- **関連（リレーションシップ）**: モデル要素同士を結ぶ線や矢印で表現される関係性
- **トレーサビリティ**: 要件の追跡可能性。上位の要求から下位の実装まで関連を追えること

### システム構成要素

- **システム価値**: システムが提供する価値を定義する領域
- **システム外部環境**: システムを取り巻く業務や環境を定義する領域  
- **システム境界**: システムとユーザー・外部システムとの接点を定義する領域
- **システム**: システム内部の情報構造と状態を定義する領域

### アクター・主体

- **アクター**: システムと関わる人や外部システム。利用者、管理者、外部システムなど
- **利用者**: システムを直接使用する人
- **関係者（ステークホルダー）**: システムに関わる全ての人や組織
- **外部システム**: 連携対象となる他のシステムやサービス

### 業務・プロセス

- **業務**: 組織が行う一連の活動や作業
- **ビジネスユースケース（BUC）**: 業務を構成する具体的な作業単位
- **アクティビティ**: BUCを構成するより詳細な作業項目
- **業務フロー**: アクティビティの時系列での流れ
- **利用シーン**: システムが利用される具体的な場面や状況

### 要件・仕様

- **要求**: ステークホルダーが システムに対して望むこと
- **要件**: 要求を実現するためにシステムが満たすべき条件
- **ユースケース（UC）**: システムが提供する機能の単位
- **機能要件**: システムが実現すべき機能に関する要件
- **非機能要件**: 性能、セキュリティ、運用性などシステム品質に関する要件

### システム境界要素

- **画面**: ユーザーとのインターフェースを表す境界要素
- **帳票**: 出力される文書や報告書
- **イベント**: 外部システムとのデータ交換のきっかけ
- **プロトコル**: システム間の通信手順や規約

### 内部構造要素

- **情報（エンティティ）**: システムが管理するデータの単位
- **状態**: 情報が取りうる状況や段階
- **状態遷移**: ある状態から別の状態への変化
- **関連**: 情報同士の関係性（1対1、1対多、多対多など）

### 条件・制約

- **バリエーション**: ビジネス上重要な区分や種別（顧客種別、商品分類など）
- **条件**: システムの動作を決定する判定基準
- **ビジネスルール**: 業務上守るべき規則や制約
- **制約**: システムが満たすべき技術的・業務的な制限事項

### 作業プロセス用語

- **洗い出し**: 必要な要素を網羅的に抽出する作業
- **関係づけ**: 要素間の関連を明確にする作業  
- **精緻化**: 粗い定義をより詳細で正確にしていく作業
- **整合性**: 各要素・図の間で矛盾がないこと
- **網羅性**: 必要な要素が漏れなく定義されていること
- **表現力**: 関係者が理解しやすく表現されていること

## RDRAの全体構造

```plantuml
@startuml

title RDRA要件定義の全体構造

left to right direction

package "システム価値" as sp {
  rectangle "システムコンテキスト" as sc
  rectangle "要求モデル" as rm
}

package "システム外部環境" as se {
  rectangle "ビジネスコンテキスト" as bc
  rectangle "ビジネスユースケース" as buc
  rectangle "業務フロー" as bf
  rectangle "利用シーン" as us
}

package "システム境界" as sb {
  rectangle "ユースケース複合図" as ucc
  rectangle "画面・帳票モデル" as ui
  rectangle "イベントモデル" as em
}

package "システム" as sys {
  rectangle "情報モデル" as im
  rectangle "状態モデル" as sm
}

sp --> se : "価値を実現する\n環境を明確化"
se --> sb : "環境での\n接点を定義"
sb --> sys : "接点を実現する\nシステムを設計"

sc --> bc : "アクター"
rm --> buc : "要求"
buc --> ucc : "ユースケース"
bf --> ucc : "アクティビティ"
us --> ucc : "利用シーン"
ucc --> im : "情報"
ucc --> sm : "状態"

@enduml
```

## 要件定義の3フェーズアプローチ

```plantuml
@startuml

title 要件定義ワークフロー - ステートチャート図

[*] --> 要件定義開始

state "フェーズ1: 議論のベースを作る" as Phase1 {
  [*] --> Step1_出発点を明らかにする
  Step1_出発点を明らかにする : システムコンテキスト図作成
  Step1_出発点を明らかにする : アクターと目的の明確化
  
  Step1_出発点を明らかにする --> Step2_スコープの把握
  Step2_スコープの把握 : ビジネスコンテキスト図作成
  Step2_スコープの把握 : BUCの粗出し
  
  Step2_スコープの把握 --> Step3_情報の明示
  Step3_情報の明示 : 業務情報の洗い出し
  Step3_情報の明示 : システム化対象の特定
  
  Step3_情報の明示 --> Step4_状態の明示
  Step4_状態の明示 : 業務状態の洗い出し
  Step4_状態の明示 : 状態遷移の概要把握
  
  Step4_状態の明示 --> [*]
  
  state Step1_出発点を明らかにする #lightblue
  state Step2_スコープの把握 #lightblue
  state Step3_情報の明示 #lightblue
  state Step4_状態の明示 #lightblue
}

Phase1 --> Phase2 : 全体像把握完了

state "フェーズ2: 要件を組み立てる" as Phase2 {
  [*] --> Step5_要件組立て
  Step5_要件組立て : UCの洗い出し
  Step5_要件組立て : 画面・イベント導出
  Step5_要件組立て : UC複合図作成
  
  Step5_要件組立て --> Step6_情報状態見直し
  Step6_情報状態見直し : 情報の関係づけ
  Step6_情報状態見直し : UCと情報・状態の関連付け
  Step6_情報状態見直し : 整合性確認
  
  Step6_情報状態見直し --> 精度確認
  
  state 精度確認 <<choice>>
  精度確認 --> Step5_要件組立て : [精度不足]
  精度確認 --> [*] : [精度十分]
  
  state Step5_要件組立て #lightgreen
  state Step6_情報状態見直し #lightgreen
}

Phase2 --> 仕様化判定 : 要件組立て完了

state 仕様化判定 <<choice>>
仕様化判定 --> Phase3 : [ビジネスルール詳細化が必要]
仕様化判定 --> 要件定義完了 : [UCで見積可能]

state "フェーズ3: ビジネスルールで仕様化可能にする" as Phase3 {
  [*] --> Step7_条件洗い出し
  Step7_条件洗い出し : UCにつながる条件の特定
  Step7_条件洗い出し : ビジネスルール明確化
  
  Step7_条件洗い出し --> Step8_バリエーション
  Step8_バリエーション : 条件の軸となる要素
  Step8_バリエーション : バリエーション整理
  
  Step8_バリエーション --> Step9_要素詳細化
  Step9_要素詳細化 : 条件とバリエーションの具体化
  Step9_要素詳細化 : 実装指針の明確化
  
  Step9_要素詳細化 --> [*]
  
  state Step7_条件洗い出し #lightyellow
  state Step8_バリエーション #lightyellow
  state Step9_要素詳細化 #lightyellow
}

Phase3 --> 要件定義完了

要件定義完了 --> [*]

note right of Phase1
  精度は無視して素早く全体像をつかむ
  分かる範囲で合意できる範囲を洗い出し
  期間目安: 4日間
end note

note right of Phase2
  RDRAの論理的つながりを利用
  トップダウンとボトムアップで整合性を高める
  最もボリュームがあるフェーズ
  期間目安: 7日間
end note

note right of Phase3
  条件やバリエーションで仕様に直結
  ビジネスルールで精度を上げる
  次の仕様化工程につなげる
  期間目安: 3日間
end note

@enduml
```

## 9ステップ詳細ワークフロー

### フェーズ1: 議論のベースを作る

#### Step1: 出発点を明らかにする

```plantuml
@startuml

title Step1: 出発点を明らかにする - ステートチャート図

[*] --> ヒアリング開始

state ヒアリング開始 {
  [*] --> 関係者特定
  関係者特定 : ステークホルダーの洗い出し
  関係者特定 : 役割と責任の明確化
  
  関係者特定 --> 登場人物洗い出し
  登場人物洗い出し : アクターの識別
  登場人物洗い出し : 外部システムの特定
  
  登場人物洗い出し --> システムコンテキスト図作成
  システムコンテキスト図作成 : アクター配置
  システムコンテキスト図作成 : システム化の目的記述
  システムコンテキスト図作成 : 外部システム連携定義
  
  システムコンテキスト図作成 --> システム化対象の合意
  システム化対象の合意 : スコープ明確化
  システム化対象の合意 : 空中戦回避の土台完成
  
  システム化対象の合意 --> [*]
}

ヒアリング開始 --> Step1完了 : 出発点明確化

Step1完了 --> [*]

note right of システムコンテキスト図作成
  - アクター（利用者）の特定
  - 外部システムの特定
  - システム化の目的を記述
  - 空中戦を避けて具体的な議論の土台作り
end note

@enduml
```

#### Step2: スコープの把握

```plantuml
@startuml

title Step2: スコープの把握 - ステートチャート図

[*] --> スコープ定義開始

state "業務全体の把握" as scope_analysis {
  [*] --> ビジネスコンテキスト図作成
  ビジネスコンテキスト図作成 : 業務の全体像把握
  ビジネスコンテキスト図作成 : 組織とアクターの関係整理
  
  ビジネスコンテキスト図作成 --> ビジネスユースケース図作成
  ビジネスユースケース図作成 : 業務の細分化
  ビジネスユースケース図作成 : BUCの洗い出し
  
  ビジネスユースケース図作成 --> アクティビティ粗出し
  アクティビティ粗出し : 具体的作業の把握
  アクティビティ粗出し : 業務フローの骨格理解
  
  アクティビティ粗出し --> スコープ確認
  
  state スコープ確認 <<choice>>
  スコープ確認 --> ビジネスコンテキスト図作成 : [見直し必要]
  スコープ確認 --> [*] : [スコープ確定]
}

scope_analysis --> Step2完了
Step2完了 --> [*]

note right of アクティビティ粗出し
  - BUCのアクティビティを粗く洗い出し
  - 正確さより洗い出すことを優先
  - システム化対象の理解を深める
  - 業務フローの骨格を把握
end note

@enduml
```

#### Step3: システムで扱う情報の明示

```plantuml
@startuml

title Step3: システムで扱う情報の明示 - ステートチャート図

[*] --> 情報分析開始

state "情報の洗い出しと整理" as info_analysis {
  [*] --> 業務情報の洗い出し
  業務情報の洗い出し : 業務で使われる全情報リスト化
  業務情報の洗い出し : 情報の種類と用途確認
  
  業務情報の洗い出し --> システム化対象情報の特定
  システム化対象情報の特定 : システム化判断
  システム化対象情報の特定 : 必須情報の選別
  
  システム化対象情報の特定 --> 情報モデル図作成_粗版
  情報モデル図作成_粗版 : 情報間の関係性整理
  情報モデル図作成_粗版 : 概念モデルの骨格作成
  
  情報モデル図作成_粗版 --> 情報確認
  
  state 情報確認 <<choice>>
  情報確認 --> 業務情報の洗い出し : [不足あり]
  情報確認 --> [*] : [情報整理完了]
}

info_analysis --> Step3完了
Step3完了 --> [*]

note right of 情報モデル図作成_粗版
  - 業務で扱う情報を明らかにする
  - システムで扱う必要がある情報を把握
  - 正確さより必要と思われるものを一旦洗い出し
  - 情報の関係性を大まかに整理
end note

@enduml
```

#### Step4: システムで管理する状態の明示

```plantuml
@startuml

title Step4: システムで管理する状態の明示 - ステートチャート図

[*] --> 状態分析開始

state "状態の洗い出しと整理" as state_analysis {
  [*] --> 業務状態の洗い出し
  業務状態の洗い出し : 業務で認識している状態を列挙
  業務状態の洗い出し : 重要な状態変化の識別
  
  業務状態の洗い出し --> 状態モデル図作成_粗版
  状態モデル図作成_粗版 : 状態の整理と分類
  状態モデル図作成_粗版 : 状態遷移の大まかな流れ
  
  状態モデル図作成_粗版 --> フェーズ1完了判定
  フェーズ1完了判定 : 全体像の確認
  フェーズ1完了判定 : 議論ベースの完成度チェック
  
  state 完了確認 <<choice>>
  フェーズ1完了判定 --> 完了確認
  完了確認 --> 業務状態の洗い出し : [見直し必要]
  完了確認 --> [*] : [フェーズ1完了]
}

state_analysis --> Step4完了
Step4完了 --> [*]

note right of 状態モデル図作成_粗版
  - 業務が認識している状態を洗い出し
  - 無理に洗い出すのではなく思いつくものを整理
  - 状態遷移の大まかな流れを把握
  - フェーズ2への準備完了
end note

@enduml
```

### フェーズ2: 要件を組み立てる

```plantuml
@startuml

title フェーズ2: 要件を組み立てる - ステートチャート図

[*] --> フェーズ2開始

state "フェーズ2: 要件を組み立てる" as Phase2_Detail {
  
  [*] --> Step5_トップダウン要件組立て
  
  state "Step5: トップダウンで要件を組み立てる" as Step5_トップダウン要件組立て {
    [*] --> 業務_BUC_アクティビティ見直し
    
    state 業務_BUC_アクティビティ見直し {
      [*] --> フェーズ1成果物の再評価
      フェーズ1成果物の再評価 : 業務モデルの確認
      フェーズ1成果物の再評価 : BUCの確認
      フェーズ1成果物の再評価 --> システム化範囲の再確認
      システム化範囲の再確認 : アクティビティ整理
      システム化範囲の再確認 --> [*]
    }
    
    業務_BUC_アクティビティ見直し --> ユースケース洗い出し
    
    state ユースケース洗い出し {
      [*] --> UCの特定
      UCの特定 : アクティビティからUC導出
      UCの特定 --> システム化範囲の明確化
      システム化範囲の明確化 : UC一覧作成
      システム化範囲の明確化 --> [*]
    }
    
    ユースケース洗い出し --> 画面_イベント導出
    
    state 画面_イベント導出 {
      [*] --> 入出力の明確化
      入出力の明確化 : 画面要素の特定
      入出力の明確化 --> 外部システム連携点の特定
      外部システム連携点の特定 : イベント定義
      外部システム連携点の特定 --> [*]
    }
    
    画面_イベント導出 --> ユースケース複合図作成
    
    state ユースケース複合図作成 {
      [*] --> UCと入出力の関連付け
      UCと入出力の関連付け : 画面との関連
      UCと入出力の関連付け : イベントとの関連
      UCと入出力の関連付け --> システム境界の明確化
      システム境界の明確化 --> [*]
    }
    
    ユースケース複合図作成 --> UC確認
    
    state UC確認 <<choice>>
    UC確認 --> 業務_BUC_アクティビティ見直し : [新規UC発見]
    UC確認 --> [*] : [洗い出し完了]
  }
  
  Step5_トップダウン要件組立て --> Step6_ボトムアップ見直し
  
  state "Step6: 情報・状態を使って見直す" as Step6_ボトムアップ見直し {
    [*] --> 情報の関係づけ
    
    state 情報の関係づけ {
      [*] --> 情報モデルの詳細化
      情報モデルの詳細化 : エンティティ整理
      情報モデルの詳細化 --> 情報間の関係性確認
      情報間の関係性確認 : 関連の定義
      情報間の関係性確認 --> [*]
    }
    
    情報の関係づけ --> 欠けている情報_状態の洗い出し
    
    state 欠けている情報_状態の洗い出し {
      [*] --> 不足情報の発見
      不足情報の発見 : ギャップ分析
      不足情報の発見 --> 状態遷移のギャップ発見
      状態遷移のギャップ発見 : 状態モデル見直し
      状態遷移のギャップ発見 --> [*]
    }
    
    欠けている情報_状態の洗い出し --> UCと情報_状態の関連付け
    
    state UCと情報_状態の関連付け {
      [*] --> UCと情報の関連明確化
      UCと情報の関連明確化 : CRUD分析
      UCと情報の関連明確化 --> UCと状態の関連明確化
      UCと状態の関連明確化 : 状態遷移とUCの対応
      UCと状態の関連明確化 --> [*]
    }
    
    UCと情報_状態の関連付け --> 整合性の確認と精度向上
    
    state 整合性の確認と精度向上 {
      [*] --> 全体整合性チェック
      全体整合性チェック : トレーサビリティ確認
      全体整合性チェック --> 要件の精度向上
      要件の精度向上 : 詳細度の確認
      要件の精度向上 --> [*]
    }
    
    整合性の確認と精度向上 --> 精度判定
    
    state 精度判定 <<choice>>
    精度判定 --> 情報の関係づけ : [精度不足]
    精度判定 --> [*] : [精度十分]
  }
  
  Step6_ボトムアップ見直し --> 繰り返し判定
  
  state 繰り返し判定 <<choice>>
  繰り返し判定 --> Step5_トップダウン要件組立て : [要件の見直し必要]
  繰り返し判定 --> [*] : [要件組立て完了]
}

Phase2_Detail --> フェーズ2完了

フェーズ2完了 --> [*]

note right of Step5_トップダウン要件組立て
  トップダウンアプローチ:
  - 業務レベルからシステムレベルへ
  - UCを中心にシステム化範囲を定義
  - 入出力を明確化
  期間目安: 3日間
end note

note right of Step6_ボトムアップ見直し
  ボトムアップアプローチ:
  - 情報と状態から要件を精緻化
  - UCとの関連性を確認
  - 全体整合性を確保
  期間目安: 4日間
end note

note right of 繰り返し判定
  Step5とStep6の反復:
  - トップダウンとボトムアップの相互検証
  - 要件の精度が十分になるまで繰り返し
  - 最もボリュームのあるフェーズ
end note

@enduml
```

### フェーズ3: ビジネスルールで仕様化可能にする

#### Step7-9: ビジネスルール詳細化

```plantuml
@startuml

title Step7-9: ビジネスルール詳細化 - ステートチャート図

[*] --> ビジネスルール定義開始

state "フェーズ3: ビジネスルールで仕様化" as phase3_detail {
  [*] --> Step7_条件洗い出し
  
  state "Step7: UCにつながる条件を洗い出す" as Step7_条件洗い出し {
    [*] --> システム動作条件考察
    システム動作条件考察 : UCごとの動作条件確認
    システム動作条件考察 --> ビジネスルール明確化
    ビジネスルール明確化 : ビジネスを駆動するルール
    ビジネスルール明確化 --> 条件として整理
    条件として整理 --> [*]
  }
  
  Step7_条件洗い出し --> Step8_バリエーション
  
  state "Step8: 条件の軸となるバリエーションを洗い出す" as Step8_バリエーション {
    [*] --> 条件の分解
    条件の分解 : 条件をバリエーションの組合せで表現
    条件の分解 --> バリエーション軸の特定
    バリエーション軸の特定 : 条件の軸となる要素を洗い出し
    バリエーション軸の特定 --> ビジネスルール構造化
    ビジネスルール構造化 --> [*]
  }
  
  Step8_バリエーション --> Step9_要素詳細化
  
  state "Step9: 条件とバリエーションの要素を洗い出す" as Step9_要素詳細化 {
    [*] --> 具体要素の洗い出し
    具体要素の洗い出し : 条件とバリエーションの具体化
    具体要素の洗い出し --> 実装指針明確化
    実装指針明確化 : 開発チーム向け指針作成
    実装指針明確化 --> バリエーション_条件図作成
    バリエーション_条件図作成 : 表形式での整理
    バリエーション_条件図作成 --> [*]
  }
  
  Step9_要素詳細化 --> [*]
}

phase3_detail --> ビジネスルール定義完了

ビジネスルール定義完了 --> [*]

note right of Step7_条件洗い出し
  システムの動作条件を考察
  ビジネスを駆動するルールを明確化
  条件としての整理
end note

note right of Step8_バリエーション
  条件はバリエーションの組合せで表現
  条件の軸となる要素を洗い出し
  ビジネスルールの構造化
end note

note right of Step9_要素詳細化
  条件とバリエーションの具体要素
  実装指針の明確化
  仕様化への準備完了
end note

@enduml
```

## 各図の作成順序とトレーサビリティ

```plantuml
@startuml

title RDRA図の作成順序とトレーサビリティ

left to right direction

rectangle "1. システムコンテキスト図" as sc #lightblue
rectangle "2. 要求モデル図" as rm #lightblue
rectangle "3. ビジネスコンテキスト図" as bc #lightgreen
rectangle "4. ビジネスユースケース図" as buc #lightgreen
rectangle "5. 業務フロー図/利用シーン図" as bf_us #lightgreen
rectangle "6. ユースケース複合図" as ucc #lightyellow
rectangle "7. 情報モデル図" as im #lightcyan
rectangle "8. 状態モデル図" as sm #lightcyan
rectangle "9. バリエーション・条件図" as vc #lightpink

sc --> bc : "アクター"
rm --> buc : "要求→BUC"
bc --> buc : "業務→BUC"
buc --> bf_us : "BUC→アクティビティ/利用シーン"
buc --> ucc : "BUC→UC"
bf_us --> ucc : "アクティビティ→UC"
ucc --> im : "UC→情報"
ucc --> sm : "UC→状態"
ucc --> vc : "UC→条件"
im --> sm : "情報→状態"

note bottom of sc
  プロジェクトの出発点
  関係者とシステムの位置づけ
end note

note bottom of ucc
  システム境界の中心
  全ての要素が集約される
end note

note bottom of im
  システムで扱うデータ構造
  概念モデルとして機能
end note

@enduml
```

## 期間配分と工数の目安

```plantuml
@startuml

title 要件定義期間配分の目安

left to right direction

rectangle "Step1\n出発点明確化\n(1日)" as s1 #lightblue
rectangle "Step2\nスコープ把握\n(1日)" as s2 #lightblue
rectangle "Step3\n情報明示\n(1日)" as s3 #lightblue
rectangle "Step4\n状態明示\n(1日)" as s4 #lightblue
rectangle "Step5\nUC組立て\n(3日)" as s5 #lightgreen
rectangle "Step6\n情報状態見直し\n(4日)" as s6 #lightgreen
rectangle "Step7\n条件洗出し\n(1日)" as s7 #lightyellow
rectangle "Step8\nバリエーション\n(1日)" as s8 #lightyellow
rectangle "Step9\n要素詳細化\n(1日)" as s9 #lightyellow

s1 --> s2
s2 --> s3
s3 --> s4
s4 --> s5
s5 --> s6
s6 --> s7
s7 --> s8
s8 --> s9

note bottom
  合計: 14日間の目安
  - フェーズ1: 4日間（全体の29%）
  - フェーズ2: 7日間（全体の50%）
  - フェーズ3: 3日間（全体の21%）
  
  実際のプロジェクトでは規模と複雑さに応じて調整
  よくわからない部分に時間を割き、明確な部分は素早く定義
end note

@enduml
```

## PlantUMLでのRDRA図作成ガイド

### アイコン対応表

```plantuml
@startuml

title PlantUMLでのRDRAアイコン対応

left to right direction

package "基本要素" {
  actor "アクター\n(actor)" as ac
  usecase "システム/業務\n(usecase)" as uc
  agent "外部システム/組織\n(agent)" as ag
  note "要求/要件\n(note)" as nt
}

package "境界要素" {
  boundary "画面\n(boundary)" as bd
  entity "情報\n(entity)" as en
  control "条件\n(control)" as ct
  interface "イベント\n(interface)" as if
}

package "構造要素" {
  rectangle "組織\n(rectangle)" as rec
  node "会社\n(node)" as nd
  artifact "ビジネス要素\n(artifact)" as art
  frame "利用シーン\n(frame)" as fr
}

@enduml
```

### PlantUMLテンプレート例

#### システムコンテキスト図

```plantuml
@startuml

title システムコンテキスト図

left to right direction

actor 会員
actor 図書館員

agent 書籍通販会社

usecase 図書館システム
note top of 図書館システム
  図書館員の作業 (書籍購買の自動連携) を支援し、本の貸
  出・返却業務において会員を待たせないスムーズな運用を
  実現する。蔵書管理をリアルタイムで行い、検索、在庫な
  ど会員サービスを向上させる
end note

:会員: -- (図書館システム)
:図書館員: -- (図書館システム)
(図書館システム) -- 書籍通販会社

@enduml
```

#### 要求モデル図

```plantuml
@startuml

title 要求モデル図

left to right direction

actor 司書
note "本の購入を簡素化したい" as s_r1
note "返却率が悪くならないように返却を簡単にする" as s_r2
note as s_dr1 #Turquoise
  本の購入を Web で直接行え、購入した本の情
  報をそのままシステムに取り込めること
end note
:司書: -- s_r1
:司書: -- s_r2
s_r1 -- s_dr1
s_r2 -- s_dr1

actor 図書館員
note "本の貸出、返却手続きを簡素化したい" as t_r1
note "本の在庫をリアルタイムで把握したい" as t_r2
note as t_dr1 #Turquoise
  本の貸出と返却を簡易に行え、リアルタ
  イムで在庫に反映できること
end note
:図書館員: -- t_r1
:図書館員: -- t_r2
t_r1 -- t_dr1
t_r2 -- t_dr1

actor 会員
note "見たい本が図書館にあるかを Web で検索したい" as k_r1
note "借りたい本を Web で予約したい" as k_r2
note as k_dr1 #Turquoise
  Web で借りたい本を検索でき、
  そのまま予約できること
end note
:会員: -- k_r1
:会員: -- k_r2
k_r1 -- k_dr1
k_r2 -- k_dr1

@enduml
```

#### ビジネスコンテキスト図

```plantuml
@startuml

title ビジネスコンテキスト図

left to right direction

actor 会員

node 図書館 {
  rectangle 窓口 {
    actor 図書館員
  }
  rectangle 司書室 {
    actor 司書
  }
  usecase 会員管理
  usecase 貸出返却
  usecase 蔵書管理
  artifact 蔵書
  artifact 書架
}

node 書籍店

:会員: -- (会員管理)
(会員管理) -- :図書館員:

:会員: -- (貸出返却)
(貸出返却) -- :図書館員:
(貸出返却) -- 蔵書
(貸出返却) -- 書架

蔵書 -- (蔵書管理)
書架 -- (蔵書管理)
(蔵書管理) - :司書:
(蔵書管理) -- 書籍店

@enduml
```

#### ビジネスユースケース図

```plantuml
@startuml

title ビジネスユースケース図 - 貸出・返却:業務

left to right direction

actor 会員
actor 図書館員

agent 窓口

usecase 窓口貸出
usecase Web予約
usecase 返却

artifact 蔵書
artifact 書架

:図書館員: -- (窓口貸出)
(窓口貸出) -- 窓口
(窓口貸出) -- 蔵書
(窓口貸出) -- 書架

:会員: -- (Web予約)
:図書館員: -- (Web予約)
(Web予約) -- 蔵書
(Web予約) -- 書架

:図書館員: -- (返却)
(返却) -- 窓口
(返却) -- 蔵書
(返却) -- 書架

@enduml
```

#### 業務フロー図

```plantuml
@startuml

title 業務フロー図 - Web予約:BUC

/'
actor 会員
actor 図書館員
usecase 貸出本の予約・取消をする
usecase 予約図書一覧を出力する
usecase 予約図書を取り置く
usecase 取置図書を消しこむ
'/

|会員|
partition 貸出予約 {
  :貸出本の予約・取消をする;
}

|図書館員|
partition 予約図書の準備 {
  :予約図書一覧を出力する;
  split
    :予約図書を取り置く;
  split again
    -> 貸出図書が無い場合;
    stop
  end split
}

|会員|
partition 予約図書を受け取る {
  :取置図書を消しこむ;
}
stop

@enduml
```

#### 利用シーン図

```plantuml
@startuml

title 利用シーン図 - 会員登録:BUC

left to right direction

actor 会員
actor 図書館員

frame 会員登録
note right of 会員登録
  本の貸出・返却時の単純化のために事前に会員登録を行う
  既に図書カードを導入しているが、忘れる人が多いので図書カード以外での確認方法も欲しい
  新しい機器を持たない老人もいるので図書カードもそのまま残したい
  会員登録も利用者本人ができるようにしたい
end note

frame 会員の確認
note right of 会員の確認
  本 (電子図書含む) の貸出の時の会員認証を簡単に行いたい
  図書カード等を忘れた場合にも口頭で対応できるようにしたい
end note

usecase 会員IDを発行する
usecase 会員カードを作成する
usecase 会員を特定する

:会員: -- 会員登録
:図書館員: -- 会員登録
会員登録 -- (会員IDを発行する)
会員登録 -- (会員カードを作成する)

:図書館員: -- 会員の確認
会員の確認 -- (会員を特定する)

@enduml
```

#### ユースケース複合図

```plantuml
@startuml

title ユースケース複合図 - Web予約:BUC

left to right direction

actor 会員

entity 貸出予約
entity 蔵書

usecase 予約図書一覧を出力する
boundary 貸出予約一覧
control 貸出予約一覧出力条件

貸出予約一覧 - (予約図書一覧を出力する)
貸出予約一覧 -- 貸出予約一覧出力条件
(予約図書一覧を出力する) -- 貸出予約

usecase 予約図書を取り置く
boundary 貸出準備登録
control 取置期限
interface 貸出可能を通知する
control 予約貸出通知メッセージ

貸出準備登録 - (予約図書を取り置く)
(予約図書を取り置く) - 取置期限
(予約図書を取り置く) -- 貸出予約
(予約図書を取り置く) -- 蔵書
(予約図書を取り置く) -- 貸出可能を通知する
予約貸出通知メッセージ - 貸出可能を通知する
貸出可能を通知する -- 会員

@enduml
```

#### ユースケース複合図 + 業務フロー

```plantuml
@startuml

title ユースケース複合図 - Web予約:BUC

left to right direction

actor 会員
actor 会員 as a会員
actor 図書館員

frame 貸出予約 as f貸出予約
frame 予約図書の準備 as f予約図書の準備
note bottom of f予約図書の準備
・貸出予約一覧を出力
・未取り置きのものを探す
・取置棚に置く
end note
frame 予約図書を受け取る as f予約図書を受け取る

usecase "貸出本の予約・取消をする"
usecase 予約図書一覧を出力する
usecase 予約図書を取り置く
usecase 予約図書を消しこむ
usecase 蔵書の貸出を登録する

boundary 蔵書検索 as b蔵書検索
boundary 貸出予約 as b貸出予約
boundary 貸出予約一覧 as b貸出予約一覧
boundary 貸出準備登録 as b貸出準備登録
boundary 予約消込 as b予約消込

control 貸出予約一覧出力条件 as c貸出予約一覧出力条件
control 取置期限 as c取置期限
control 予約貸出通知メッセージ as c予約貸出通知メッセージ

entity 貸出予約 as e貸出予約
entity 蔵書 as e蔵書

interface 貸出可能を通知する as i貸出可能を通知する

:会員: -- f貸出予約
f貸出予約 -- (貸出本の予約・取消をする)
b蔵書検索 - (貸出本の予約・取消をする)
b貸出予約 - (貸出本の予約・取消をする)
(貸出本の予約・取消をする) -- e蔵書
(貸出本の予約・取消をする) -- e貸出予約

f貸出予約 -> f予約図書の準備

:図書館員: -- f予約図書の準備
c貸出予約一覧出力条件 - b貸出予約一覧
b貸出予約一覧 - (予約図書一覧を出力する)
f予約図書の準備 -- (予約図書一覧を出力する)
(予約図書一覧を出力する) -- e貸出予約

f予約図書の準備 -- (予約図書を取り置く)
b貸出準備登録 - (予約図書を取り置く)
(予約図書を取り置く) - c取置期限
(予約図書を取り置く) -- e貸出予約
(予約図書を取り置く) -- e蔵書
(予約図書を取り置く) -- i貸出可能を通知する
c予約貸出通知メッセージ - i貸出可能を通知する
i貸出可能を通知する -- :a会員:

f予約図書の準備 -> f予約図書を受け取る

:会員: -- f予約図書を受け取る
:図書館員: -- f予約図書を受け取る
f予約図書を受け取る -- (予約図書を消しこむ)
(予約図書を消しこむ) - (蔵書の貸出を登録する)
b予約消込 - (予約図書を消しこむ)
(予約図書を消しこむ) -- e貸出予約

@enduml
```

#### ユースケース複合図 + 利用シーン

```plantuml
@startuml

title ユースケース複合図 - 期限管理:BUC

left to right direction

actor 会員
actor 図書館員
actor 日時<<タイマー>>

frame 取置図書の返却
note bottom of 取置図書の返却
  取り置き期限切れのものを書架に戻す
end note

usecase 貸出期限を確認する
usecase 取置期限を確認する

boundary 取置期限切れ as b取置期限切れ

entity 貸出図書
entity 貸出予約
entity 取置期限切れ

interface 貸出期限切れ通知
interface 取置期限切れ通知

:日時: -- (貸出期限を確認する)
(貸出期限を確認する) -- 貸出図書
(貸出期限を確認する) -- 貸出期限切れ通知
貸出期限切れ通知 -- :会員:

:日時: -- (取置期限を確認する)
(取置期限を確認する) -- 貸出予約
(取置期限を確認する) -- 取置期限切れ通知
取置期限切れ通知 -- :会員:
(取置期限を確認する) - 取置期限切れ

:図書館員: -- 取置図書の返却
取置図書の返却 -- (取置期限を確認する)
b取置期限切れ - (取置期限を確認する)

@enduml
```

#### 情報モデル図

```plantuml
@startuml

title 情報モデル図

left to right direction

entity 会員

entity 本
entity 蔵書
entity 書架

entity 貸出予約
entity 貸出図書

entity 書籍発注

会員 -- 貸出予約
貸出予約 -- 本

会員 -- 貸出図書
貸出図書 -- 本

本 - 蔵書
蔵書 - 書架

本 -- 書籍発注

@enduml
```

#### 状態モデル図

```plantuml
@startuml

title 状態モデル図 - Web予約:情報

/'
usecase 貸出本を予約する
usecase 貸出本を予約取消する
usecase 予約図書を取り置く
usecase 取置期限を確認する
usecase 取置図書を消しこむ
'/

state 未予約

state 予約中 {
  state 未準備
  state 準備完了
}

[*] --> 未予約
未予約 --> [*]

未予約 --> 未準備: (貸出本を予約する)
予約中 --> 未予約: (貸出本を予約取消する)

未準備 --> 準備完了: (予約図書を取り置く)

準備完了 --> 準備完了: (取置期限を確認する)\n[取置期限 >= 今]
準備完了 --> 未予約: (取置期限を確認する)\n[取置期限 < 今]

準備完了 --> 未予約: (取置図書を消しこむ)

@enduml
```

## まとめ

RDRAを使った要件定義は以下の特徴があります：

1. **段階的洗練**: 3フェーズで徐々に精度を上げる
2. **網羅性**: システム価値から段階的に要素を導出
3. **整合性**: 図間の関連性で整合性を保証
4. **表現力**: 視覚的なダイアグラムで共通理解を促進
5. **トレーサビリティ**: 全ての要素が関連づけられている

このワークフローに従うことで、短時間で精度の高い要件定義が可能になります。PlantUMLを活用することで、テキストベースでの管理とバージョン管理が容易になり、チーム開発にも適用しやすくなります。

## 参考文献

- [RDRA2.0 ハンドブック](https://www.amazon.co.jp/RDRA2-0-ハンドブック-軽く柔軟で精度の高い要件定義のモデリング手法-神崎善司-ebook/dp/B07STQZFBX)
- PlantUML公式サイト: https://plantuml.com/ja/